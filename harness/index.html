<!DOCTYPE html>
<html>
<head>
    <title>Antigravity Looker Harness</title>
    <style>
        body, html { height: 100%; margin: 0; font-family: sans-serif; }
        #vis-container { height: 80vh; border: 1px solid #ccc; margin: 20px; }
        #controls { padding: 20px; background: #f0f0f0; }
    </style>
</head>
<body>
    <div id="controls">
        <button onclick="renderScenario('simple')">Load Simple Data</button>
        <button onclick="renderScenario('empty')">Load Empty Data</button>
        <button onclick="renderScenario('simple_pivot')">Load Pivot Data</button>
    </div>
    
    <div id="vis-container"></div>
    <div id="vis-container"></div>

    <script src="mocks.js"></script>
    <script src="data_scenarios.js"></script>

    <script src="../dist/custom_pivot.js"></script>

    <script>
        function renderScenario(name) {
            const scenario = scenarios[name];
            const container = document.getElementById('vis-container');
            
            // 1. Clean container
            container.innerHTML = '';

            // 2. Initialize (create)
          // Retrieve the registered visualization from looker.plugins.visualizations
          const vizId = "custom_pivot"; // Must match the id in custom_pivot.js
          const viz = looker.plugins.visualizations[vizId];

          if (!viz) {
            console.error(`Visualization '${vizId}' not registered! Available:`, Object.keys(looker.plugins.visualizations));
                return;
            }
            
            // Call create() only once in a real app, but here we reset for simplicity
          // In a real app we would check if we already created it.
          // For harness, we might just clear container and create again?
          // Or reuse if possible.
          // Let's just create again for simplicity but we might leak listeners if any.
          viz.create(container, scenario.config, {}, { escape: (x) => x });

            // 3. Update (updateAsync)
            console.log(`Rendering scenario: ${name}`);
          viz.updateAsync(
                scenario.data,
                container,
                scenario.config,
                scenario.queryResponse,
            { crossfilterEnabled: false }, // details
                () => console.log('Finished Rendering (done called)')
            );
        }
    </script>
</body>
</html>